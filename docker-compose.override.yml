version: '3.8'

# Override de desarrollo local (opcional)
# Usar con: docker compose -f docker-compose.yml -f docker-compose.override.yml up -d

services:
  php:
    # En desarrollo, reconstruir cada vez que cambie Dockerfile
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - BUILD_ENV=development
    environment:
      - APP_DEBUG=true
      - LOG_LEVEL=debug
    # Montar código en vivo
    volumes:
      - ./backend:/var/www/html
      - ./storage:/var/www/html/storage
      - /var/www/html/vendor  # No sincronizar vendor

  nginx:
    # En desarrollo, recargar configuración
    environment:
      - NGINX_ENTRYPOINT_QUIET_LOGS=1

  db:
    # Reducir constraints en desarrollo
    environment:
      - MYSQL_ROOT_PASSWORD=secret
      - MYSQL_DATABASE=cloudmedia
    ports:
      - '3306:3306'
